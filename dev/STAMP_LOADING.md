# Dynamic Stamp Loading for Android

**Runtime Manifest Generation with Version Check**:

1. Java code scans `assets/data/stamps/` **at runtime** during app startup
2. Generates `stamp_manifest` in `files/` with version header
3. On app update: Automatic regeneration
4. C code reads manifest and loads stamps dynamically
5. **No hardcoded categories** in code
6. **No build-time script** required

## How It Works

### App Startup (Java)

`tuxpaintActivity.generateStampManifest()`:
1. Checks if `files/stamp_manifest` exists
2. Compares saved version with current app version
3. On version mismatch or missing file: Regeneration
4. Scans `assets/data/stamps/` recursively using `AssetManager.list()`
5. Creates manifest:

```
# VERSION=9350
[animals]
animals/amphibians
animals/birds
animals/birds/cartoon
...

[clothes]
clothes
clothes/armor/cartoon
...
```

### Runtime (C)

`load_stamps_from_config()` in `tuxpaint.c`:
1. Reads `files/stamp_manifest` (generated by Java)
2. Detects categories dynamically via `[category_name]` markers
3. Loads each directory with `tp_ftw()`
4. All stamps of a category → same `stamp_group`

## Result

```
16 categories (dynamically detected)
788 stamps loaded
125 directories scanned

animals:        146 stamps → group 0
clothes:         19 stamps → group 1
food:            67 stamps → group 2
hobbies:         13 stamps → group 3
household:       33 stamps → group 4
medical:          5 stamps → group 5
military:         8 stamps → group 6
naturalforces:    3 stamps → group 7
people:           6 stamps → group 8
plants:          39 stamps → group 9
seasonal:        61 stamps → group 10
space:           16 stamps → group 11
sports:          12 stamps → group 12
symbols:        248 stamps → group 13
town:            78 stamps → group 14
vehicles:        34 stamps → group 15
```

## Adding New Stamps

1. Copy files to `assets/data/stamps/[category]/[subdir]/`
2. Build & Install
3. On first start: Automatic regeneration (new version detected)
4. Done - **no code changes required**

## Adding New Category

1. Create directory `assets/data/stamps/new_category/`
2. Add stamps
3. Build & Install
4. Category is **automatically detected** on next start
5. Gets a new `stamp_group` automatically

## Technical Details

- **No hardcoded arrays** anymore
- **No category names** in C code
- **Categories = first level** in `assets/data/stamps/`
- **Flat loading**: All subdirectories of a category → one group
- **Runtime generation** at app start (once, cached with version)
- **Automatic update** on app version change


## Files

| File | Purpose |
|------|---------|
| `assets/data/stamps/**` | Stamp files (PNG/SVG) |
| `files/stamp_manifest` | Runtime-generated with version header |
| `tuxpaintActivity.java: generateStampManifest()` | Scans assets |
| `tuxpaintActivity.java: scanStampDirectory()` | Recursive scanning |
| `tuxpaint.c: load_stamps_from_config()` | Loads manifest |
| `android_assets.c: setfilesdir()` | JNI for files path |
